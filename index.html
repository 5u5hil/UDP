<!Doctype html>
<html>
    <head>
        <title>UDP</title>
        <meta charset="utf-8">
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1,width=device-width, height=device-height, target-densitydpi=device-dpi" />
    </head>
    <body>

        <form class="pure-form pure-form-aligned">
            <fieldset>
                <div class="pure-control-group">
                    <label for="name">IP</label>
                    <input id="ip" name="ip" type="text" value="192.168.1." placeholder="IP">
                </div>

                <div class="pure-control-group">
                    <label for="name">Port</label>
                    <input id="port" name="port" type="number" value="7000" placeholder="Port">
                </div>

                <div class="pure-controls">
                    <button type="button" class="pure-button pure-button-primary" id="connect">Connect</button>
                </div>
            </fieldset>
        </form>

        <form class="pure-form pure-form-aligned">
            <fieldset>
                <div class="pure-control-group">
                    <label for="name">Send Message</label>
                    <input id="msg" name="msg" type="text" value="Hello World!" placeholder="Message">
                </div>

                <div class="pure-controls">
                    <button type="button" class="pure-button pure-button-primary" id="send">Send</button>
                </div>
            </fieldset>
        </form>

        <p>To Subscribe use this IP : <strong id="myip"></strong></p>

        <ul id="log">
            <li><strong>Received Messages</strong></li>
        </ul>



        <script type="text/javascript" src="jquery.min.js"></script>
        <script type="text/javascript" src="phonegap.js"></script>





        <script type="text/javascript">


            var key = "";


            document.addEventListener('deviceready', function () {
                alert(window.tlantic.plugins.socket.receiveHookName);

                networkinterface.getIPAddress(function (ip) {

                    alert("ip");
                    $("#myip").text(ip);
                });


                $("#connect").click(function () {
                    alert($("#ip").val());
                    window.tlantic.plugins.socket.connect(onConnect, stub, $("#ip").val(), $("#port").val());
                });

                $("#send").click(function () {
                    window.tlantic.plugins.socket.send(stub, stub, key, $("#msg").val());
                });

            }, false);



            function stub(d) {
                alert(JSON.stringify(d));
            }

            function onConnect(k) {
                alert('Established connection with ', k);
                key = k;
            }


            document.addEventListener(window.tlantic.plugins.socket.receiveHookName, function (ev) {
                $("#log").append("<li>" + ev.metadata.data + "</li>");

            });





        </script>
    </body>
</html>