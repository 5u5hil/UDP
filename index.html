<!Doctype html>
<html>
    <head>
        <title>UDP</title>
        <meta charset="utf-8">
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1,width=device-width, height=device-height, target-densitydpi=device-dpi" />
    </head>
    <body>

        <form class="pure-form pure-form-aligned">
            <fieldset>
                <div class="pure-control-group">
                    <label for="name">IP</label>
                    <input id="ip" name="ip" type="text" value="192.168.0.101" placeholder="IP">
                </div>

                <div class="pure-control-group">
                    <label for="name">Port</label>
                    <input id="port" name="port" type="number" value="55056" placeholder="Port">
                </div>

                <div class="pure-control-group">
                    <label for="name">Send Message</label>
                    <input id="msg" name="msg" type="text" value="Hello World!" placeholder="Message">
                </div>

                <div class="pure-controls">
                    <button type="button" class="pure-button pure-button-primary" id="send">Send</button>
                </div>
            </fieldset>
        </form>

        <p>To Subscribe use this IP : <strong id="myip"></strong> <input type="number" name="rport" value="1823" /></p>

        <ul id="log">
            <li><strong>Received Messages</strong></li>
        </ul>



        <script type="text/javascript" src="jquery.min.js"></script>
        <script type="text/javascript" src="phonegap.js"></script>





        <script type="text/javascript">




            document.addEventListener('deviceready', function () {




                networkinterface.getIPAddress(function (ip) {

                    $("#myip").text(ip);
                });



                $("#send").click(function () {
                    var address = $("#ip").val();
                    var port = $("#port").val();
                    var data = str2ab($("#msg").val());

alert(data);

                    chrome.sockets.udp.create({}, function (socketInfo) {
                        alert(JSON.stringify(socketInfo));
                        var socketId = socketInfo.socketId;

                        chrome.sockets.udp.getInfo(socketId, function (result) {
                            toast(result);
                        });

                        if (result < 0) {
                            toast(chrome.runtime.lastError.message);
                        } else {
                            chrome.sockets.udp.send(socketId, data, address, port, function (sendInfo) {
                                if (sendInfo.resultCode < 0) {
                                    toast(chrome.runtime.lastError.message);
                                } else {
                                    toast(sendInfo);
                                }
                            });
                        }

                    });

                });

            }, false);




            function str2ab(str) {
                var buf = new Int8Array(str.length);

                for (var i = 0, strLen = str.length; i < strLen; i++) {
                    buf[i] = str.charCodeAt(i);
                }

                return buf.buffer;
            }

            function toast(m) {
                alert(JSON.stringify(m));
            }



        </script>
    </body>
</html>